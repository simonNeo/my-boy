<script setup lang="ts">
import { computed, watch } from "vue";

const props = defineProps({
  itemId: {
    type: Number,
    required: true,
  },
  size: {
    type: Number,
    default: 32,
  },
});

const isDogma = computed(() => {
  return +props.itemId === 633;
});

const positionMap: { [key: number]: [number, number] } = {
  1: [-32, 0],
  2: [-64, 0],
  3: [-96, 0],
  4: [-128, 0],
  5: [-160, 0],
  6: [-192, 0],
  7: [-224, 0],
  8: [-256, 0],
  9: [-288, 0],
  10: [-320, 0],
  11: [-352, 0],
  12: [-384, 0],
  13: [-416, 0],
  14: [-448, 0],
  15: [-480, 0],
  16: [-512, 0],
  17: [-544, 0],
  18: [-576, 0],
  19: [-608, 0],
  20: [0, -32],
  21: [-32, -32],
  22: [-64, -32],
  23: [-96, -32],
  24: [-128, -32],
  25: [-160, -32],
  26: [-192, -32],
  27: [-224, -32],
  28: [-256, -32],
  29: [-288, -32],
  30: [-320, -32],
  31: [-352, -32],
  32: [-384, -32],
  33: [-416, -32],
  34: [-448, -32],
  35: [-480, -32],
  36: [-512, -32],
  37: [-544, -32],
  38: [-576, -32],
  39: [-608, -32],
  40: [0, -64],
  41: [-32, -64],
  42: [-64, -64],
  44: [-96, -64],
  45: [-128, -64],
  46: [-160, -64],
  47: [-192, -64],
  48: [-224, -64],
  49: [-256, -64],
  50: [-288, -64],
  51: [-320, -64],
  52: [-352, -64],
  53: [-384, -64],
  54: [-416, -64],
  55: [-448, -64],
  56: [-480, -64],
  57: [-512, -64],
  58: [-544, -64],
  59: [-576, -64],
  60: [-608, -64],
  62: [0, -96],
  63: [-32, -96],
  64: [-64, -96],
  65: [-96, -96],
  66: [-128, -96],
  67: [-160, -96],
  68: [-192, -96],
  69: [-224, -96],
  70: [-256, -96],
  71: [-288, -96],
  72: [-320, -96],
  73: [-352, -96],
  74: [-384, -96],
  75: [-416, -96],
  76: [-448, -96],
  77: [-480, -96],
  78: [-512, -96],
  79: [-544, -96],
  80: [-576, -96],
  81: [-608, -96],
  82: [0, -128],
  83: [-32, -128],
  84: [-64, -128],
  85: [-96, -128],
  86: [-128, -128],
  87: [-160, -128],
  88: [-192, -128],
  89: [-224, -128],
  90: [-256, -128],
  91: [-288, -128],
  92: [-320, -128],
  93: [-352, -128],
  94: [-384, -128],
  95: [-416, -128],
  96: [-448, -128],
  97: [-480, -128],
  98: [-512, -128],
  99: [-544, -128],
  100: [-576, -128],
  101: [-608, -128],
  102: [0, -160],
  103: [-32, -160],
  104: [-64, -160],
  105: [-96, -160],
  106: [-128, -160],
  107: [-160, -160],
  108: [-192, -160],
  109: [-224, -160],
  110: [-256, -160],
  111: [-288, -160],
  112: [-320, -160],
  113: [-352, -160],
  114: [-384, -160],
  115: [-416, -160],
  116: [-448, -160],
  117: [-480, -160],
  118: [-512, -160],
  119: [-544, -160],
  120: [-576, -160],
  121: [-608, -160],
  122: [0, -192],
  123: [-32, -192],
  124: [-64, -192],
  125: [-96, -192],
  126: [-128, -192],
  127: [-160, -192],
  128: [-192, -192],
  129: [-224, -192],
  130: [-256, -192],
  131: [-288, -192],
  132: [-320, -192],
  133: [-352, -192],
  134: [-384, -192],
  135: [-416, -192],
  136: [-448, -192],
  137: [-480, -192],
  138: [-512, -192],
  139: [-544, -192],
  140: [-576, -192],
  141: [-608, -192],
  142: [0, -224],
  143: [-32, -224],
  144: [-64, -224],
  145: [-96, -224],
  146: [-128, -224],
  147: [-160, -224],
  148: [-192, -224],
  149: [-224, -224],
  150: [-256, -224],
  151: [-288, -224],
  152: [-320, -224],
  153: [-352, -224],
  154: [-384, -224],
  155: [-416, -224],
  156: [-448, -224],
  157: [-480, -224],
  158: [-512, -224],
  159: [-544, -224],
  160: [-576, -224],
  161: [-608, -224],
  162: [0, -256],
  163: [-32, -256],
  164: [-64, -256],
  165: [-96, -256],
  166: [-128, -256],
  167: [-160, -256],
  168: [-192, -256],
  169: [-224, -256],
  170: [-256, -256],
  171: [-288, -256],
  172: [-320, -256],
  173: [-352, -256],
  174: [-384, -256],
  175: [-416, -256],
  176: [-448, -256],
  177: [-480, -256],
  178: [-512, -256],
  179: [-544, -256],
  180: [-576, -256],
  181: [-608, -256],
  182: [0, -288],
  183: [-32, -288],
  184: [-64, -288],
  185: [-96, -288],
  186: [-128, -288],
  187: [-160, -288],
  188: [-192, -288],
  189: [-224, -288],
  190: [-256, -288],
  191: [-288, -288],
  192: [-320, -288],
  193: [-352, -288],
  194: [-384, -288],
  195: [-416, -288],
  196: [-448, -288],
  197: [-480, -288],
  198: [-512, -288],
  199: [-544, -288],
  200: [-576, -288],
  201: [-608, -288],
  202: [0, -320],
  203: [-32, -320],
  204: [-64, -320],
  205: [-96, -320],
  206: [-128, -320],
  207: [-160, -320],
  208: [-192, -320],
  209: [-224, -320],
  210: [-256, -320],
  211: [-288, -320],
  212: [-320, -320],
  213: [-352, -320],
  214: [-384, -320],
  215: [-416, -320],
  216: [-448, -320],
  217: [-480, -320],
  218: [-512, -320],
  219: [-544, -320],
  220: [-576, -320],
  221: [-608, -320],
  222: [0, -352],
  223: [-32, -352],
  224: [-64, -352],
  225: [-96, -352],
  226: [-128, -352],
  227: [-160, -352],
  228: [-192, -352],
  229: [-224, -352],
  230: [-256, -352],
  231: [-288, -352],
  232: [-320, -352],
  233: [-352, -352],
  234: [-384, -352],
  236: [-416, -352],
  237: [-448, -352],
  238: [-480, -352],
  239: [-512, -352],
  240: [-544, -352],
  241: [-576, -352],
  242: [-608, -352],
  243: [0, -384],
  244: [-32, -384],
  245: [-64, -384],
  246: [-96, -384],
  247: [-128, -384],
  248: [-160, -384],
  249: [-192, -384],
  250: [-224, -384],
  251: [-256, -384],
  252: [-288, -384],
  253: [-320, -384],
  254: [-352, -384],
  255: [-384, -384],
  256: [-416, -384],
  257: [-448, -384],
  258: [-480, -384],
  259: [-512, -384],
  260: [-544, -384],
  261: [-576, -384],
  262: [-608, -384],
  263: [0, -416],
  264: [-32, -416],
  265: [-64, -416],
  266: [-96, -416],
  267: [-128, -416],
  268: [-160, -416],
  269: [-192, -416],
  270: [-224, -416],
  271: [-256, -416],
  272: [-288, -416],
  273: [-320, -416],
  274: [-352, -416],
  275: [-384, -416],
  276: [-416, -416],
  277: [-448, -416],
  278: [-480, -416],
  279: [-512, -416],
  280: [-544, -416],
  281: [-576, -416],
  282: [-608, -416],
  283: [0, -448],
  284: [-32, -448],
  285: [-64, -448],
  286: [-96, -448],
  287: [-128, -448],
  288: [-160, -448],
  289: [-192, -448],
  290: [-224, -448],
  291: [-256, -448],
  292: [-288, -448],
  293: [-320, -448],
  294: [-352, -448],
  295: [-384, -448],
  296: [-416, -448],
  297: [-448, -448],
  298: [-480, -448],
  299: [-512, -448],
  300: [-544, -448],
  301: [-576, -448],
  302: [-608, -448],
  303: [0, -480],
  304: [-32, -480],
  305: [-64, -480],
  306: [-96, -480],
  307: [-128, -480],
  308: [-160, -480],
  309: [-192, -480],
  310: [-224, -480],
  311: [-256, -480],
  312: [-288, -480],
  313: [-320, -480],
  314: [-352, -480],
  315: [-384, -480],
  316: [-416, -480],
  317: [-448, -480],
  318: [-480, -480],
  319: [-512, -480],
  320: [-544, -480],
  321: [-576, -480],
  322: [-608, -480],
  323: [0, -512],
  324: [-32, -512],
  325: [-64, -512],
  326: [-96, -512],
  327: [-128, -512],
  328: [-160, -512],
  329: [-192, -512],
  330: [-224, -512],
  331: [-256, -512],
  332: [-288, -512],
  333: [-320, -512],
  334: [-352, -512],
  335: [-384, -512],
  336: [-416, -512],
  337: [-448, -512],
  338: [-480, -512],
  339: [-512, -512],
  340: [-544, -512],
  341: [-576, -512],
  342: [-608, -512],
  343: [0, -544],
  344: [-32, -544],
  345: [-64, -544],
  346: [-96, -544],
  347: [-128, -544],
  348: [-160, -544],
  349: [-192, -544],
  350: [-224, -544],
  351: [-256, -544],
  352: [-288, -544],
  353: [-320, -544],
  354: [-352, -544],
  355: [-384, -544],
  356: [-416, -544],
  357: [-448, -544],
  358: [-480, -544],
  359: [-512, -544],
  360: [-544, -544],
  361: [-576, -544],
  362: [-608, -544],
  363: [0, -576],
  364: [-32, -576],
  365: [-64, -576],
  366: [-96, -576],
  367: [-128, -576],
  368: [-160, -576],
  369: [-192, -576],
  370: [-224, -576],
  371: [-256, -576],
  372: [-288, -576],
  373: [-320, -576],
  374: [-352, -576],
  375: [-384, -576],
  376: [-416, -576],
  377: [-448, -576],
  378: [-480, -576],
  379: [-512, -576],
  380: [-544, -576],
  381: [-576, -576],
  382: [-608, -576],
  383: [0, -608],
  384: [-32, -608],
  385: [-64, -608],
  386: [-96, -608],
  387: [-128, -608],
  388: [-160, -608],
  389: [-192, -608],
  390: [-224, -608],
  391: [-256, -608],
  392: [-288, -608],
  393: [-320, -608],
  394: [-352, -608],
  395: [-384, -608],
  396: [-416, -608],
  397: [-448, -608],
  398: [-480, -608],
  399: [-512, -608],
  400: [-544, -608],
  401: [-576, -608],
  402: [-608, -608],
  403: [0, -640],
  404: [-32, -640],
  405: [-64, -640],
  406: [-96, -640],
  407: [-128, -640],
  408: [-160, -640],
  409: [-192, -640],
  410: [-224, -640],
  411: [-256, -640],
  412: [-288, -640],
  413: [-320, -640],
  414: [-352, -640],
  415: [-384, -640],
  416: [-416, -640],
  417: [-448, -640],
  418: [-480, -640],
  419: [-512, -640],
  420: [-544, -640],
  421: [-576, -640],
  422: [-608, -640],
  423: [0, -672],
  424: [-32, -672],
  425: [-64, -672],
  426: [-96, -672],
  427: [-128, -672],
  428: [-160, -672],
  429: [-192, -672],
  430: [-224, -672],
  431: [-256, -672],
  432: [-288, -672],
  433: [-320, -672],
  434: [-352, -672],
  435: [-384, -672],
  436: [-416, -672],
  437: [-448, -672],
  438: [-480, -672],
  439: [-512, -672],
  440: [-544, -672],
  441: [-576, -672],
  442: [-608, -672],
  443: [0, -704],
  444: [-32, -704],
  445: [-64, -704],
  446: [-96, -704],
  447: [-128, -704],
  448: [-160, -704],
  449: [-192, -704],
  450: [-224, -704],
  451: [-256, -704],
  452: [-288, -704],
  453: [-320, -704],
  454: [-352, -704],
  455: [-384, -704],
  456: [-416, -704],
  457: [-448, -704],
  458: [-480, -704],
  459: [-512, -704],
  460: [-544, -704],
  461: [-576, -704],
  462: [-608, -704],
  463: [0, -736],
  464: [-32, -736],
  465: [-64, -736],
  466: [-96, -736],
  467: [-128, -736],
  468: [-160, -736],
  469: [-192, -736],
  470: [-224, -736],
  471: [-256, -736],
  472: [-288, -736],
  473: [-320, -736],
  474: [-352, -736],
  475: [-384, -736],
  476: [-416, -736],
  477: [-448, -736],
  478: [-480, -736],
  479: [-512, -736],
  480: [-544, -736],
  481: [-576, -736],
  482: [-608, -736],
  483: [0, -768],
  484: [-32, -768],
  485: [-64, -768],
  486: [-96, -768],
  487: [-128, -768],
  488: [-160, -768],
  489: [-192, -768],
  490: [-224, -768],
  491: [-256, -768],
  492: [-288, -768],
  493: [-320, -768],
  494: [-352, -768],
  495: [-384, -768],
  496: [-416, -768],
  497: [-448, -768],
  498: [-480, -768],
  499: [-512, -768],
  500: [-544, -768],
  501: [-576, -768],
  502: [-608, -768],
  503: [0, -800],
  504: [-32, -800],
  505: [-64, -800],
  506: [-96, -800],
  507: [-128, -800],
  508: [-160, -800],
  509: [-192, -800],
  510: [-224, -800],
  511: [-256, -800],
  512: [-288, -800],
  513: [-320, -800],
  514: [-352, -800],
  515: [-384, -800],
  516: [-416, -800],
  517: [-448, -800],
  518: [-480, -800],
  519: [-512, -800],
  520: [-544, -800],
  521: [-576, -800],
  522: [-608, -800],
  523: [0, -832],
  524: [-32, -832],
  525: [-64, -832],
  526: [-96, -832],
  527: [-128, -832],
  528: [-160, -832],
  529: [-192, -832],
  530: [-224, -832],
  531: [-256, -832],
  532: [-288, -832],
  533: [-320, -832],
  534: [-352, -832],
  535: [-384, -832],
  536: [-416, -832],
  537: [-448, -832],
  538: [-480, -832],
  539: [-512, -832],
  540: [-544, -832],
  541: [-576, -832],
  542: [-608, -832],
  543: [0, -864],
  544: [-32, -864],
  545: [-64, -864],
  546: [-96, -864],
  547: [-128, -864],
  548: [-160, -864],
  549: [-192, -864],
  550: [-224, -864],
  551: [-256, -864],
  552: [-288, -864],
  553: [-320, -864],
  554: [-352, -864],
  555: [-384, -864],
  556: [-416, -864],
  557: [-448, -864],
  558: [-480, -864],
  559: [-512, -864],
  560: [-544, -864],
  561: [-576, -864],
  562: [-608, -864],
  563: [0, -896],
  564: [-32, -896],
  565: [-64, -896],
  566: [-96, -896],
  567: [-128, -896],
  568: [-160, -896],
  569: [-192, -896],
  570: [-224, -896],
  571: [-256, -896],
  572: [-288, -896],
  573: [-320, -896],
  574: [-352, -896],
  575: [-384, -896],
  576: [-416, -896],
  577: [-448, -896],
  578: [-480, -896],
  579: [-512, -896],
  580: [-544, -896],
  581: [-576, -896],
  582: [-608, -896],
  583: [0, -928],
  584: [-32, -928],
  585: [-64, -928],
  586: [-96, -928],
  588: [-128, -928],
  589: [-160, -928],
  590: [-192, -928],
  591: [-224, -928],
  592: [-256, -928],
  593: [-288, -928],
  594: [-320, -928],
  595: [-352, -928],
  596: [-384, -928],
  597: [-416, -928],
  598: [-448, -928],
  599: [-480, -928],
  600: [-512, -928],
  601: [-544, -928],
  602: [-576, -928],
  603: [-608, -928],
  604: [0, -960],
  605: [-32, -960],
  606: [-64, -960],
  607: [-96, -960],
  608: [-128, -960],
  609: [-160, -960],
  610: [-192, -960],
  611: [-224, -960],
  612: [-256, -960],
  614: [-288, -960],
  615: [-320, -960],
  616: [-352, -960],
  617: [-384, -960],
  618: [-416, -960],
  619: [-448, -960],
  621: [-480, -960],
  622: [-512, -960],
  623: [-544, -960],
  624: [-576, -960],
  625: [-608, -960],
  626: [0, -992],
  627: [-32, -992],
  628: [-64, -992],
  629: [-96, -992],
  631: [-128, -992],
  632: [-160, -992],
  633: [-192, -992],
  634: [-224, -992],
  635: [-256, -992],
  636: [-288, -992],
  637: [-320, -992],
  638: [-352, -992],
  639: [-384, -992],
  640: [-416, -992],
  641: [-448, -992],
  642: [-480, -992],
  643: [-512, -992],
  644: [-544, -992],
  645: [-576, -992],
  646: [-608, -992],
  647: [0, -1024],
  649: [-32, -1024],
  650: [-64, -1024],
  651: [-96, -1024],
  652: [-128, -1024],
  653: [-160, -1024],
  654: [-192, -1024],
  655: [-224, -1024],
  656: [-256, -1024],
  657: [-288, -1024],
  658: [-320, -1024],
  659: [-352, -1024],
  660: [-384, -1024],
  661: [-416, -1024],
  663: [-448, -1024],
  664: [-480, -1024],
  665: [-512, -1024],
  667: [-544, -1024],
  668: [-576, -1024],
  669: [-608, -1024],
  670: [0, -1056],
  671: [-32, -1056],
  672: [-64, -1056],
  673: [-96, -1056],
  674: [-128, -1056],
  675: [-160, -1056],
  676: [-192, -1056],
  677: [-224, -1056],
  678: [-256, -1056],
  679: [-288, -1056],
  680: [-320, -1056],
  681: [-352, -1056],
  682: [-384, -1056],
  683: [-416, -1056],
  684: [-448, -1056],
  685: [-480, -1056],
  686: [-512, -1056],
  687: [-544, -1056],
  688: [-576, -1056],
  689: [-608, -1056],
  690: [0, -1088],
  691: [-32, -1088],
  692: [-64, -1088],
  693: [-96, -1088],
  694: [-128, -1088],
  695: [-160, -1088],
  696: [-192, -1088],
  697: [-224, -1088],
  698: [-256, -1088],
  699: [-288, -1088],
  700: [-320, -1088],
  701: [-352, -1088],
  702: [-384, -1088],
  703: [-416, -1088],
  704: [-448, -1088],
  705: [-480, -1088],
  706: [-512, -1088],
  707: [-544, -1088],
  708: [-576, -1088],
  709: [-608, -1088],
  710: [0, -1120],
  711: [-32, -1120],
  712: [-64, -1120],
  713: [-96, -1120],
  714: [-128, -1120],
  715: [-160, -1120],
  716: [-192, -1120],
  717: [-224, -1120],
  719: [-256, -1120],
  720: [-288, -1120],
  721: [-320, -1120],
  722: [-352, -1120],
  723: [-384, -1120],
  724: [-416, -1120],
  725: [-448, -1120],
  726: [-480, -1120],
  727: [-512, -1120],
  728: [-544, -1120],
  729: [-576, -1120],
  730: [-608, -1120],
  731: [0, -1152],
  732: [-32, -1152],
};

watch(
  [isDogma, () => props.size],
  ([, newSize]) => {
    const style = document.querySelector("#anim-dogma-size-" + newSize);
    if (style) {
      return;
    }
    if (isDogma.value) {
      const style = document.createElement("style");
      style.id = "anim-dogma-size-" + newSize;
      const scale = +newSize / 32;
      const keyframeMap: { [key: number]: number[] } = {
        0: [-64, -1152],
        3: [-96, -1152],
        6: [-128, -1152],
        10: [-160, -1152],
        13: [-192, -1152],
        17: [-224, -1152],
        20: [-256, -1152],
        24: [-288, -1152],
        27: [-320, -1152],
        31: [-352, -1152],
        34: [-384, -1152],
        37: [-416, -1152],
        41: [-448, -1152],
        44: [-480, -1152],
        48: [-512, -1152],
        51: [-544, -1152],
        55: [-576, -1152],
        58: [-608, -1152],
        62: [-0, -1184],
        65: [-32, -1184],
        68: [-64, -1184],
        72: [-96, -1184],
        75: [-128, -1184],
        79: [-160, -1184],
        82: [-192, -1184],
        86: [-224, -1184],
        89: [-256, -1184],
        93: [-288, -1184],
        96: [-320, -1184],
        100: [-352, -1184],
      };
      const keyframeStyle = Object.keys(keyframeMap)
        .map((key) => {
          return `${key}% {
        background-position: ${keyframeMap[key][0] * scale}px ${
            keyframeMap[key][1] * scale
          }px;
      }`;
        })
        .join("\n");
      style.innerHTML = `
    @keyframes dogma-anim-size-${props.size} {
      ${keyframeStyle}
    }`;
      document.head.appendChild(style);
    }
  },
  { immediate: true }
);
const computedStyle = computed(() => {
  const size = +props.size;

  // 原图尺寸640*1280
  const originWidth = 640;
  const originHeight = 1280;
  const originSize = 32;
  const width = size;
  const height = size;
  const scale = size / originSize;

  const style: any = {
    backgroundSize: `${originWidth * scale}px ${originHeight * scale}px`,
    width: `${width}px`,
    height: `${height}px`,
  };
  if (isDogma.value) {
    // 教条特殊处理
    style["animationName"] = `dogma-anim-size-${props.size}`;
  } else {
    style["backgroundPosition"] = `${positionMap[props.itemId][0] * scale}px ${
      positionMap[props.itemId][1] * scale
    }px`;
  }
  return style;
});
</script>

<template>
  <div
    v-if="props.itemId"
    class="item-icon"
    :class="+props.itemId === 633 ? 'dogma' : ''"
    :style="computedStyle"
  ></div>
</template>

<style scope>
.item-icon {
  width: 32px;
  height: 32px;
  background: url(../assets/item_sprite.png) no-repeat;
  vertical-align: middle;
  display: inline-block;
}

.dogma {
  animation-duration: 500ms;
  animation-iteration-count: infinite;
  animation-timing-function: step-start;
}
</style>
